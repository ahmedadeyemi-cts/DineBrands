<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dine Brands CasePop</title>

<script>
let dinePop = null;

async function runScreenPop() {

    const url = new URL(window.location.href);
    const phone = url.searchParams.get("phone");
    const email = url.searchParams.get("email");

    if (!phone || !email) {
        document.body.innerHTML = "<h2>Error: phone and email parameters are required.</h2>";
        return;
    }

    const payload = {
        secret_key: "TrainSecret@a29m!",
        company_id: "SYS",
        b05_code: "800",
        phone: phone,
        c06_code: "0000",
        user_code_field: {
            uxx_code: "u03_code",
            user_code_identity: email
        }
    };

    // ‚≠ê This is the key: give the popup a fixed name
    dinePop = window.open("about:blank", "DinePop", "width=900,height=700");

    // Write loading message
    dinePop.document.open();
    dinePop.document.write("<h2>Loading screen pop...</h2>");
    dinePop.document.close();

    try {
        const response = await fetch("https://USECASEPOP054A.myastutesolutions.com/api/screen", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const text = await response.text();

        dinePop.document.open();
        dinePop.document.write(`
            <h2>Dine Brands Screen Pop Response</h2>
            <pre>${text.replace(/</g, "&lt;")}</pre>
        `);
        dinePop.document.close();

    } catch (err) {
        dinePop.document.open();
        dinePop.document.write(`
            <h2>Request Failed</h2>
            <pre>${err}</pre>
        `);
        dinePop.document.close();
    }
}
</script>
</head>

<body onload="runScreenPop()">
<h3>Processing screen pop...</h3>
</body>
</html>

//Created and maintained by Ahmed Adeyemi, US Signal.
