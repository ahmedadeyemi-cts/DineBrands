<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dine Brands CasePop</title>

<script>
let dinePop = null;

async function runScreenPop() {

    const url = new URL(window.location.href);
    const phone = url.searchParams.get("phone");
    const email = url.searchParams.get("email");

    if (!phone || !email) {
        document.body.innerHTML = "<h2>Error: phone and email parameters are required.</h2>";
        return;
    }

    const payload = {
        secret_key: "TrainSecret@a29m!",
        company_id: "SYS",
        b05_code: "800",
        phone: phone,
        c06_code: "0000",
        user_code_field: {
            uxx_code: "u03_code",
            user_code_identity: email
        }
    };

    // Open or reuse popup by fixed name
    dinePop = window.open("about:blank", "DinePop", "width=900,height=700");

    // Loading screen with logo
    dinePop.document.open();
    dinePop.document.write(`
        <div style="text-align:center; margin-top:30px; font-family:Arial, sans-serif;">
            <img src="https://cdn.cookielaw.org/logos/de9c8170-4f8f-4c2c-bad0-0878e7e40cf0/b5704931-48da-424f-8f39-bd0abe0aca9a/e8944123-9f9c-4145-81b7-2dbb7ee9eb99/Dine_Hirez.png"
                 alt="Dine Brands Logo"
                 style="width:200px; margin-bottom:20px;">
            <h2>Loading screen pop...</h2>
            <p style="margin-top:40px; font-size:12px; color:#555;">
                Created and Maintained by Ahmed Adeyemi, US Signal, 2025
            </p>
        </div>
    `);
    dinePop.document.close();

    try {
        const response = await fetch("https://USECASEPOP054A.myastutesolutions.com/api/screen", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const text = await response.text();

        // Final response screen with logo
        dinePop.document.open();
        dinePop.document.write(`
            <div style="text-align:center; margin-top:30px; font-family:Arial, sans-serif;">
                <img src="https://cdn.cookielaw.org/logos/de9c8170-4f8f-4c2c-bad0-0878e7e40cf0/b5704931-48da-424f-8f39-bd0abe0aca9a/e8944123-9f9c-4145-81b7-2dbb7ee9eb99/Dine_Hirez.png"
                     alt="Dine Brands Logo"
                     style="width:200px; margin-bottom:20px;">
                <h2>Dine Brands Screen Pop Response</h2>
            </div>

            <pre style="white-space:pre-wrap; word-break:break-word; padding:20px; background:#f3f3f3; border-radius:8px; font-family:Consolas, monospace;">
${text.replace(/</g, "&lt;")}
            </pre>

            <div style="text-align:center; margin-top:40px; font-size:12px; color:#555; font-family:Arial, sans-serif;">
                Created and Maintained by Ahmed Adeyemi, US Signal, 2025
            </div>
        `);
        dinePop.document.close();

    } catch (err) {
        // Failure screen with logo
        dinePop.document.open();
        dinePop.document.write(`
            <div style="text-align:center; margin-top:30px; font-family:Arial, sans-serif;">
                <img src="https://cdn.cookielaw.org/logos/de9c8170-4f8f-4c2c-bad0-0878e7e40cf0/b5704931-48da-424f-8f39-bd0abe0aca9a/e8944123-9f9c-4145-81b7-2dbb7ee9eb99/Dine_Hirez.png"
                     alt="Dine Brands Logo"
                     style="width:200px; margin-bottom:20px;">
                <h2>Request Failed</h2>
            </div>

            <pre style="white-space:pre-wrap; word-break:break-word; padding:20px; background:#fee; border-radius:8px; font-family:Consolas, monospace;">
${err}
            </pre>

            <div style="text-align:center; margin-top:40px; font-size:12px; color:#555;">
                Created and Maintained by Ahmed Adeyemi, US Signal, 2025
            </div>
        `);
        dinePop.document.close();
    }
}
</script>
</head>

<body onload="runScreenPop()" style="text-align:center; font-family:Arial, sans-serif; margin-top:50px;">
    <img src="https://cdn.cookielaw.org/logos/de9c8170-4f8f-4c2c-bad0-0878e7e40cf0/b5704931-48da-424f-8f39-bd0abe0aca9a/e8944123-9f9c-4145-81b7-2dbb7ee9eb99/Dine_Hirez.png"
         alt="Dine Brands Logo"
         style="width:200px; margin-bottom:20px;">

    <h3>Processing screen pop...</h3>

    <p style="margin-top:40px; font-size:12px; color:#555;">
        Created and Maintained by Ahmed Adeyemi, US Signal, 2025
    </p>
</body>
</html>
