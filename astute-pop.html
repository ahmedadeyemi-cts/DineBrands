<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dine Brands CasePop</title>

<script>
// Global reference to popup window
let popup = null;

async function runScreenPop() {
    const url = new URL(window.location.href);
    const phone = url.searchParams.get("phone");
    const email = url.searchParams.get("email");

    if (!phone || !email) {
        document.body.innerHTML = "<h2>Error: phone and email parameters are required.</h2>";
        return;
    }

    const payload = {
        secret_key: "TrainSecret@a29m!",
        company_id: "SYS",
        b05_code: "800",
        phone: phone,
        c06_code: "0000",
        user_code_field: {
            uxx_code: "u03_code",
            user_code_identity: email
        }
    };

    // ‚≠ê The key to reusing the same tab
    popup = window.open("about:blank", "casepopWindow", "popup=true");

    // Make sure the document exists before writing
    popup.document.open();
    popup.document.write("<h2>Loading screen pop...</h2>");
    popup.document.close();

    try {
        const response = await fetch("https://USECASEPOP054A.myastutesolutions.com/api/screen", {
            method: "POST",
            headers: { 
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        const text = await response.text();

        popup.document.open();
        popup.document.write(`
            <h2>Dine Brands Screen Pop Response</h2>
            <pre>${text.replace(/</g,"&lt;")}</pre>
        `);
        popup.document.close();

    } catch (err) {
        popup.document.open();
        popup.document.write(`
            <h2>Request Failed</h2>
            <pre>${err}</pre>
        `);
        popup.document.close();
    }
}
</script>
</head>

<body onload="runScreenPop()">
<h3>Processing screen pop...</h3>
</body>
</html>
//Created by Ahmed Adeyemi, US Signal.
